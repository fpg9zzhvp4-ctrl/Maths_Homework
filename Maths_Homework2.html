<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maths Homework Practice Quiz</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; background-color: #f5f5f5; margin: 0; padding: 20px; }
h1 { margin-bottom: 20px; }

#menu button, #scoreScreen button { display: block; margin: 10px auto; padding: 12px; font-size: 18px; border-radius: 8px; cursor: pointer; width: 200px; }

#quiz, #scoreScreen, #timesUpScreen { display: none; }

#numberPad {
  display: grid;
  grid-template-columns: repeat(3, 15vw);
  grid-template-rows: repeat(4, 15vw);
  grid-gap: 3vw;
  justify-content: center;
  margin: 0 auto 5vw auto;
}
#numberPad button, #enterBtn, #clearBtn {
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.1s, transform 0.1s;
}
#numberPad button {
  width: 100%;
  height: 100%;
  font-size: 5vw;
}
#numberPad button:active, #enterBtn:active, #clearBtn:active,
.highlight {
  background-color: #ddd !important;
  transform: scale(0.95);
}

#answerButtons {
  display: grid;
  grid-template-columns: repeat(2, 40vw);
  grid-gap: 5vw;
  justify-content: center;
  margin: 5vw auto 0 auto;
}
#enterBtn, #clearBtn {
  width: 100%;
  height: 12vw;
  font-size: 5vw;
  border: none;
  color: white;
}
#enterBtn { background-color: #4CAF50; }
#clearBtn { background-color: #f44336; }
#enterBtn:hover { background-color: #45a049; }
#clearBtn:hover { background-color: #e53935; }

#answerDisplay { font-size: 24px; margin: 15px 0; }
#question { font-size: 48px; font-weight: bold; margin: 20px 0; }
.countdown { color: #FF5722; }

.slider { position: relative; display: inline-block; width: 60px; height: 34px; }
.slider input { opacity: 0; width: 0; height: 0; }
.slider span { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider span:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + span { background-color: #4CAF50; }
input:checked + span:before { transform: translateX(26px); }

#stats { margin-top: 20px; font-size: 16px; }
#confettiCanvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; display:none; z-index:9999; }

@media (min-width: 600px) {
  #numberPad { grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(4, 60px); grid-gap: 10px; }
  #numberPad button { font-size: 24px; }
  #answerButtons { grid-template-columns: repeat(2, 140px); grid-gap: 15px; }
  #enterBtn, #clearBtn { font-size: 24px; height: 70px; }
}
</style>
</head>
<body>

<h1>Maths Homework Practice Quiz</h1>

<div id="menu">
  <label style="font-size:18px;">üîä Read questions aloud:
    <label class="slider">
      <input type="checkbox" id="speechToggle">
      <span></span>
    </label>
  </label>

  <div id="weekButtons"></div>
  <button id="resetAllBtn">Reset All Scores</button>
  <div id="stats"></div>
</div>

<div id="quiz">
  <h2 id="question"></h2>
  <div id="answerDisplay">‚Äî</div>
  <div id="numberPad"></div>
  <div id="answerButtons">
    <button id="enterBtn">Enter</button>
    <button id="clearBtn">Clear</button>
  </div>
  <p id="feedback"></p>
  <p id="timer"></p>
</div>

<div id="timesUpScreen">
  <h2>‚è∞ Time‚Äôs up!</h2>
  <button id="timesUpOkBtn">OK</button>
</div>

<div id="scoreScreen">
  <h2 id="scoreText"></h2>
  <button id="startAgainBtn">Start Again</button>
  <button id="menuBtn">Return to Menu</button>
  <button id="resetWeekBtn">Reset This Week‚Äôs Score</button>
</div>

<canvas id="confettiCanvas"></canvas>

<audio id="beepSound">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YRAAAAAA" type="audio/wav">
</audio>

<script>
let quizData, currentWeek, currentQuestions, questionIndex = 0;
let score = 0, startTime, timerInterval, currentAnswer = '';
let scores = JSON.parse(localStorage.getItem('quizScores') || '{}');
let speechOn = JSON.parse(localStorage.getItem('speechOn') || 'true');

const menu = document.getElementById('menu');
const quiz = document.getElementById('quiz');
const scoreScreen = document.getElementById('scoreScreen');
const weekButtons = document.getElementById('weekButtons');
const stats = document.getElementById('stats');
const questionEl = document.getElementById('question');
const numberPadEl = document.getElementById('numberPad');
const answerDisplay = document.getElementById('answerDisplay');
const feedbackEl = document.getElementById('feedback');
const timerEl = document.getElementById('timer');
const enterBtn = document.getElementById('enterBtn');
const clearBtn = document.getElementById('clearBtn');
const timesUpScreen = document.getElementById('timesUpScreen');
const timesUpOkBtn = document.getElementById('timesUpOkBtn');
const speechToggle = document.getElementById('speechToggle');
const beepSound = document.getElementById('beepSound');

speechToggle.checked = speechOn;
speechToggle.onchange = () => {
  speechOn = speechToggle.checked;
  localStorage.setItem('speechOn', speechOn);
};

async function loadData() {
  const res = await fetch('quizData.json');
  quizData = await res.json();
  buildMenu();
}

function buildMenu() {
  weekButtons.innerHTML = '';
  Object.keys(quizData.weeks).forEach(weekName => {
    const btn = document.createElement('button');
    btn.textContent = weekName;
    btn.onclick = () => startWeek(weekName);
    weekButtons.appendChild(btn);
  });
  document.getElementById('resetAllBtn').onclick = resetAllScores;
  renderStats();
}

function renderStats() {
  stats.innerHTML = '<h3>Scores</h3>';
  Object.keys(quizData.weeks).forEach(weekName => {
    const data = scores[weekName];
    const text = data ? `Score: ${data.score}, Best time: ${data.time.toFixed(1)}s` : 'Not played yet';
    stats.innerHTML += `<p><b>${weekName}:</b> ${text}</p>`;
  });
}

function startWeek(weekName) {
  currentWeek = weekName;
  currentQuestions = quizData.weeks[weekName].questions;
  questionIndex = 0;
  score = 0;
  currentAnswer = '';
  feedbackEl.textContent = '';
  answerDisplay.textContent = '‚Äî';
  menu.style.display = 'none';
  scoreScreen.style.display = 'none';
  timesUpScreen.style.display = 'none';
  quiz.style.display = 'block';
  showCountdown(3, () => {
    startTimer(quizData.weeks[weekName].timeLimit);
    showQuestion();
  });
}

function showCountdown(seconds, callback) {
  questionEl.textContent = 'Get Ready!';
  questionEl.classList.remove('countdown');
  
  setTimeout(() => {
    questionEl.classList.add('countdown');
    questionEl.textContent = seconds;
    
    const interval = setInterval(() => {
      seconds--;
      if (seconds > 0) {
        questionEl.textContent = seconds;
      } else {
        clearInterval(interval);
        questionEl.textContent = '';
        questionEl.classList.remove('countdown');
        callback();
      }
    }, 1000);
    
  }, 1000);
}

function showQuestion() {
  if (questionIndex >= currentQuestions.length) {
    if (score === currentQuestions.length) launchConfetti();
    return endQuiz();
  }
  const q = currentQuestions[questionIndex];
  questionEl.textContent = q.text;
  currentAnswer = '';
  answerDisplay.textContent = '‚Äî';
  feedbackEl.textContent = '';
  buildNumberPad();
  if (speechOn) speak(q.text);
}

function buildNumberPad() {
  numberPadEl.innerHTML = '';
  for (let i = 1; i <= 9; i++) {
    const btn = document.createElement('button');
    btn.textContent = i;
    btn.onclick = () => { flashButton(btn); addDigit(i); };
    numberPadEl.appendChild(btn);
  }
  const zeroBtn = document.createElement('button');
  zeroBtn.textContent = '0';
  zeroBtn.onclick = () => { flashButton(zeroBtn); addDigit(0); };
  zeroBtn.style.gridColumn = '2 / 3';
  numberPadEl.appendChild(zeroBtn);
}

function addDigit(digit) {
  beepSound.currentTime = 0;
  beepSound.play();
  currentAnswer += digit.toString();
  answerDisplay.textContent = currentAnswer;
}

function flashButton(btn) {
  btn.classList.add('highlight');
  setTimeout(() => btn.classList.remove('highlight'), 150);
}

enterBtn.onclick = () => { flashButton(enterBtn); handleEnter(); };
clearBtn.onclick = () => { flashButton(clearBtn); handleClear(); };

function handleEnter() {
  if (!currentAnswer) return;
  const correct = currentQuestions[questionIndex].answer.toString();
  if (currentAnswer === correct) {
    score++;
    feedbackEl.textContent = '‚úÖ Correct! üéâ';
    questionIndex++;
    setTimeout(showQuestion, 600);
  } else {
    feedbackEl.textContent = '‚ùå Try again! üí™';
    currentAnswer = '';
    answerDisplay.textContent = '‚Äî';
  }
}

function handleClear() {
  currentAnswer = '';
  answerDisplay.textContent = '‚Äî';
  feedbackEl.textContent = '';
}

function startTimer(limit) {
  clearInterval(timerInterval);
  startTime = Date.now();
  timerInterval = setInterval(() => {
    const elapsed = (Date.now() - startTime) / 1000;
    timerEl.textContent = `Time: ${elapsed.toFixed(1)}s`;
    if (elapsed >= limit) {
      clearInterval(timerInterval);
      showTimesUp();
    }
  }, 100);
}

function showTimesUp() {
  quiz.style.display = 'none';
  timesUpScreen.style.display = 'block';
}

timesUpOkBtn.onclick = () => {
  timesUpScreen.style.display = 'none';
  endQuiz();
};

function endQuiz() {
  clearInterval(timerInterval);
  const totalTime = (Date.now() - startTime) / 1000;
  const best = scores[currentWeek]?.time || Infinity;
  const bestScore = scores[currentWeek]?.score || 0;
  if (score > bestScore || (score === bestScore && totalTime < best)) {
    scores[currentWeek] = { score, time: totalTime };
    localStorage.setItem('quizScores', JSON.stringify(scores));
  }
  quiz.style.display = 'none';
  scoreScreen.style.display = 'block';
  document.getElementById('scoreText').textContent =
    `üéä You scored ${score}/${currentQuestions.length} in ${totalTime.toFixed(1)}s!`;
  document.getElementById('startAgainBtn').onclick = () => startWeek(currentWeek);
  document.getElementById('menuBtn').onclick = () => {
    scoreScreen.style.display = 'none';
    menu.style.display = 'block';
    renderStats();
  };
  document.getElementById('resetWeekBtn').onclick = () => resetWeekScore(currentWeek);
}

function resetWeekScore(weekName) {
  delete scores[weekName];
  localStorage.setItem('quizScores', JSON.stringify(scores));
  renderStats();
}

function resetAllScores() {
  if (confirm('Reset all scores?')) {
    scores = {};
    localStorage.removeItem('quizScores');
    renderStats();
  }
}

function speak(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'en-GB';
  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

// Confetti
function launchConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  canvas.style.display = 'block';
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const confettiCount = 150;
  const confetti = [];
  for (let i = 0; i < confettiCount; i++) {
    confetti.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      r: Math.random() * 6 + 4,
      d: Math.random() * confettiCount,
      color: `hsl(${Math.random() * 360}, 100%, 50%)`,
      tilt: Math.random() * 10 - 10,
      tiltAngleIncremental: Math.random() * 0.07 + 0.05
    });
  }
  let animationFrame;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    confetti.forEach(c => {
      ctx.beginPath();
      ctx.lineWidth = c.r / 2;
      ctx.strokeStyle = c.color;
      ctx.moveTo(c.x + c.tilt + c.r / 4, c.y);
      ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r / 4);
      ctx.stroke();
      c.tilt += c.tiltAngleIncremental;
      c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2;
      if (c.y > canvas.height) {
        c.y = -10;
        c.x = Math.random() * canvas.width;
      }
    });
    animationFrame = requestAnimationFrame(draw);
  }
  draw();
  setTimeout(() => {
    cancelAnimationFrame(animationFrame);
    canvas.style.display = 'none';
  }, 5000);
}

loadData();
</script>
</body>
</html>